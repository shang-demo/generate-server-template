{"version":3,"sources":["index.js"],"names":["parseArgv","targetDir","program","version","arguments","option","action","target","parse","process","argv","model","koaServer","socketIO","senecaClient","senecaServer","customerErrors","templateDir","setTemplateDir","yj","si","gsConfig","JSON","stringify","e","message","exit","test","cwd","targetDirIsExists","confirm","type","name","default","info","skipInstall","Object","keys","forEach","key","result","builder","Builder","run"],"mappings":"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","sourcesContent":["import program from 'commander';\nimport { stat } from 'fs-extra';\nimport { resolve as pathResolve } from 'path';\nimport { prompt } from 'inquirer';\n\nimport { colorEcho } from './util';\nimport { getConfig, setConfig } from './user-data';\nimport Builder from './Builder';\n\nasync function parseArgv() {\n  let targetDir;\n\n  program\n    .version('0.0.1', '-v, --version')\n    .arguments('<target>')\n    .option('--setTemplateDir <set template dir>', 'set template dir persistence')\n    .option('-t --templateDir <template dir>', 'set template dir')\n    .option('-k --koaServer', 'add koa server')\n    .option('-i --socketIO', 'add socket io server')\n    .option('-c --senecaClient', 'add seneca client')\n    .option('-s --senecaServer', 'add seneca server')\n    .option('-m --model', 'add model')\n    .option('-e --customerErrors <error-package>', 'add customer errors package')\n    .option('--yj <cloudnapps-template-dir>', 'build for cloudnapps')\n    .option('--si', 'skip yarn install')\n    .action((target) => {\n      targetDir = target;\n    })\n    .parse(process.argv);\n\n  let {\n    model,\n    koaServer,\n    socketIO,\n    senecaClient,\n    senecaServer,\n    customerErrors,\n    templateDir,\n    setTemplateDir,\n    yj,\n    si,\n  } = program;\n\n  if (setTemplateDir) {\n    try {\n      let gsConfig = await setConfig({ templateDir: setTemplateDir });\n      colorEcho(JSON.stringify(gsConfig));\n    }\n    catch (e) {\n      colorEcho(e.message);\n      process.exit(1);\n    }\n    process.exit(0);\n  }\n\n  if (!templateDir) {\n    ({ templateDir } = await getConfig());\n  }\n\n  if (!templateDir) {\n    colorEcho(' gs -t <use templateDir> or gs --setTemplateDir <set template dir>');\n    process.exit(1);\n  }\n\n  // must be a type to generate\n  if (!koaServer && !senecaClient && !senecaServer) {\n    koaServer = true;\n  }\n\n  // socketIO must with koaServer\n  if (socketIO && !koaServer) {\n    colorEcho('socketIo need koaServer; `gs -ki`');\n    process.exit(1);\n  }\n\n  if (koaServer && senecaServer) {\n    colorEcho('koa server or seneca server should be only');\n    process.exit(1);\n  }\n\n  // resolve target dir\n  if (!targetDir) {\n    colorEcho('no target dir given!');\n    process.exit(1);\n  }\n  else if (!/^\\//.test(targetDir)) {\n    targetDir = pathResolve(process.cwd(), targetDir);\n  }\n\n  let targetDirIsExists = false;\n  try {\n    await stat(targetDir);\n    targetDirIsExists = true;\n  }\n  catch (e) {\n    targetDirIsExists = false;\n  }\n\n  if (targetDirIsExists) {\n    let { confirm } = await prompt({\n      type: 'confirm',\n      name: 'confirm',\n      message: `${targetDir} is exists, cover it?`,\n      default: false,\n    });\n\n    if (!confirm) {\n      colorEcho(`${targetDir} exists`);\n      process.exit(1);\n    }\n  }\n\n  let info = {\n    targetDir,\n    templateDir,\n    model,\n    koaServer,\n    socketIO,\n    senecaClient,\n    senecaServer,\n    customerErrors,\n    yj,\n    skipInstall: yj ? true : si,\n  };\n\n  let message = '';\n  Object.keys(info).forEach((key) => {\n    if (info[key]) {\n      message = `${message}${key}: ${info[key]}\\n  `;\n    }\n  });\n\n  let { confirm } = await prompt({\n    type: 'confirm',\n    name: 'confirm',\n    message,\n    default: true,\n  });\n\n  if (!confirm) {\n    process.exit(1);\n  }\n\n  return info;\n}\n\n(async () => {\n  let result = await parseArgv();\n  let builder = new Builder(result);\n  await builder.run();\n})();\n"],"file":"index.js"}