{"version":3,"sources":["index.js"],"names":["parseArgv","targetDir","program","version","arguments","option","action","target","parse","process","argv","templateDir","gstConfig","JSON","stringify","e","message","exit","koaServer","senecaClient","senecaServer","test","cwd","targetDirIsExists","confirm","type","name","default","info","dir","model","customerErrors","Object","keys","forEach","key","arr","ensureTargetDir","cpBase","buildComponents","buildConfigFile","buildIndexJs","buildPackage","Promise","each","fun"],"mappings":"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","sourcesContent":["import Promise from 'bluebird';\nimport program from 'commander';\nimport { stat } from 'fs-extra';\nimport { resolve as pathResolve } from 'path';\nimport { prompt } from 'inquirer';\n\nimport { colorEcho } from './util';\nimport { getConfig, setConfig } from './user-data';\nimport {\n  ensureTargetDir,\n  cpBase,\n  buildComponents,\n  buildConfigFile,\n  buildIndexJs,\n  buildPackage,\n} from './build';\n\nasync function parseArgv() {\n  let targetDir;\n\n  program\n    .version('0.0.1', '-v, --version')\n    .arguments('<target>')\n    .option('-t --templateDir <template dir>', 'set template dir')\n    .option('-k --koaServer', 'add koa server')\n    .option('-c --senecaClient', 'add seneca client')\n    .option('-s --senecaServer', 'add seneca server')\n    .option('-m --model', 'add model')\n    .option('-e --customerErrors <error-package>', 'add customer errors package')\n    .action((target) => {\n      targetDir = target;\n    })\n    .parse(process.argv);\n\n  if (program.templateDir) {\n    try {\n      let gstConfig = await setConfig({ templateDir: program.templateDir });\n      colorEcho(JSON.stringify(gstConfig));\n    }\n    catch (e) {\n      colorEcho(e.message);\n      process.exit(1);\n    }\n    process.exit(0);\n  }\n\n  let { templateDir } = await getConfig();\n\n  if (!templateDir) {\n    colorEcho('gst -t <template dir> to set template dir');\n    process.exit(1);\n  }\n\n  // must be a type to generate\n  if (!program.koaServer && !program.senecaClient && !program.senecaServer) {\n    program.koaServer = true;\n  }\n\n  if (program.koaServer && program.senecaServer) {\n    colorEcho('koa server or seneca server should be only');\n    process.exit(1);\n  }\n\n  // resolve target dir\n  if (!targetDir) {\n    colorEcho('no target dir given!');\n    process.exit(1);\n  }\n  else if (!/^\\//.test(targetDir)) {\n    targetDir = pathResolve(process.cwd(), targetDir);\n  }\n\n  let targetDirIsExists = false;\n  try {\n    await stat(targetDir);\n    targetDirIsExists = true;\n  }\n  catch (e) {\n    targetDirIsExists = false;\n  }\n\n  if (targetDirIsExists) {\n    let { confirm } = await prompt({\n      type: 'confirm',\n      name: 'confirm',\n      message: `${targetDir} is exists, cover it?`,\n      default: false,\n    });\n\n    if (!confirm) {\n      colorEcho(`${targetDir} exists`);\n      process.exit(1);\n    }\n  }\n\n  let info = {\n    dir: targetDir,\n    model: program.model,\n    koaServer: program.koaServer,\n    senecaClient: program.senecaClient,\n    senecaServer: program.senecaServer,\n    customerErrors: program.customerErrors,\n  };\n\n  let message = '';\n  Object.keys(info).forEach((key) => {\n    if (info[key]) {\n      message = `${message}${key}: ${info[key]}\\n  `;\n    }\n  });\n\n  let { confirm } = await prompt({\n    type: 'confirm',\n    name: 'confirm',\n    message,\n    default: true,\n  });\n\n  if (!confirm) {\n    process.exit(1);\n  }\n\n  return targetDir;\n}\n\n(async () => {\n  let targetDir = await parseArgv();\n\n  let arr = [ensureTargetDir, cpBase, buildComponents, buildConfigFile, buildIndexJs, buildPackage];\n\n  let {\n    model, koaServer, senecaClient, senecaServer, customerErrors,\n  } = program;\n\n  await Promise.each(arr, (fun) => {\n    return fun(targetDir, {\n      model,\n      koaServer,\n      senecaClient,\n      senecaServer,\n      customerErrors,\n    });\n  });\n})();\n"],"file":"index.js"}